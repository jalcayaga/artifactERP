(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4317],{3185:function(e,s,t){Promise.resolve().then(t.bind(t,8187))},8187:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var a=t(7437),n=t(2265),r=t(2779),i=t(6070),l=t(3985),d=t(4508),c=t(3713),o=t(3578),h=t(2869),x=t(8560),u=t(6110),m=t(6801),j=t(4493),p=t(4438),f=e=>{var s;let{invoice:t,onClose:r,onPaymentSuccess:i}=e,[l,x]=(0,n.useState)([]),[f,g]=(0,n.useState)(!1);(0,n.useEffect)(()=>{t&&m.t.getPaymentsByInvoice(t.id).then(x)},[t]);let v=l.reduce((e,s)=>e+parseFloat(s.amount),0),y=parseFloat(t.grandTotal)-v;return(0,a.jsx)(u.Vq,{open:!0,onOpenChange:r,children:(0,a.jsxs)(u.cZ,{className:"max-w-4xl",children:[(0,a.jsxs)(u.fK,{children:[(0,a.jsxs)(u.$N,{children:["Detalle de Factura - ",t.invoiceNumber]}),(0,a.jsx)(u.Be,{children:"Aqu\xed puedes ver los detalles completos de la factura, incluyendo los \xedtems, pagos registrados y el monto adeudado."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 py-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Empresa:"})," ",null===(s=t.company)||void 0===s?void 0:s.name]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Fecha de Emisi\xf3n:"})," ",new Date(t.issueDate).toLocaleDateString()]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Fecha de Vencimiento:"})," ",t.dueDate?new Date(t.dueDate).toLocaleDateString():"N/A"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Estado:"})," ",t.status]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Orden de Venta:"})," ",t.orderId]})]}),(0,a.jsx)("h4",{className:"font-semibold mt-4",children:"\xcdtems de la Factura"}),(0,a.jsxs)(o.iA,{children:[(0,a.jsx)(o.xD,{children:(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.ss,{children:"Producto"}),(0,a.jsx)(o.ss,{className:"text-center",children:"Cantidad"}),(0,a.jsx)(o.ss,{className:"text-right",children:"Precio Unit."}),(0,a.jsx)(o.ss,{className:"text-right",children:"Total"})]})}),(0,a.jsx)(o.RM,{children:t.items.map(e=>(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.pj,{children:e.product.name}),(0,a.jsx)(o.pj,{className:"text-center",children:e.quantity}),(0,a.jsx)(o.pj,{className:"text-right",children:(0,d.eQ)(e.unitPrice)}),(0,a.jsx)(o.pj,{className:"text-right",children:(0,d.eQ)(e.totalPriceWithVat)})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex justify-end mt-4 space-x-4 font-semibold",children:[(0,a.jsx)("div",{children:"Subtotal:"}),(0,a.jsx)("div",{children:(0,d.eQ)(t.subTotalAmount)})]}),(0,a.jsxs)("div",{className:"flex justify-end mt-2 space-x-4 font-semibold",children:[(0,a.jsx)("div",{children:"IVA (19%):"}),(0,a.jsx)("div",{children:(0,d.eQ)(t.vatAmount)})]}),(0,a.jsxs)("div",{className:"flex justify-end mt-2 space-x-4 font-bold text-lg",children:[(0,a.jsx)("div",{children:"Total:"}),(0,a.jsx)("div",{children:(0,d.eQ)(t.grandTotal)})]}),(0,a.jsx)("h4",{className:"font-semibold mt-6",children:"Pagos"}),(0,a.jsxs)(o.iA,{children:[(0,a.jsx)(o.xD,{children:(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.ss,{children:"Fecha"}),(0,a.jsx)(o.ss,{children:"Monto"}),(0,a.jsx)(o.ss,{children:"M\xe9todo"}),(0,a.jsx)(o.ss,{children:"Notas"})]})}),(0,a.jsxs)(o.RM,{children:[l.map(e=>(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.pj,{children:new Date(e.paymentDate).toLocaleDateString()}),(0,a.jsx)(o.pj,{children:(0,d.eQ)(e.amount)}),(0,a.jsx)(o.pj,{children:e.paymentMethod}),(0,a.jsx)(o.pj,{children:e.notes})]},e.id)),0===l.length&&(0,a.jsx)(o.SC,{children:(0,a.jsx)(o.pj,{colSpan:4,className:"text-center",children:"No hay pagos registrados."})})]})]}),(0,a.jsxs)("div",{className:"flex justify-end mt-2 space-x-4 font-bold text-lg",children:[(0,a.jsx)("div",{children:"Total Pagado:"}),(0,a.jsx)("div",{children:(0,d.eQ)(v)})]}),(0,a.jsxs)("div",{className:"flex justify-end mt-2 space-x-4 font-bold text-lg text-destructive",children:[(0,a.jsx)("div",{children:"Monto Adeudado:"}),(0,a.jsx)("div",{children:(0,d.eQ)(y)})]}),f?(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h4",{className:"font-semibold mb-4",children:"Registrar Nuevo Pago"}),(0,a.jsx)(j.Z,{invoice:t,onSave:()=>{g(!1),i()},onCancel:()=>g(!1)})]}):y>0&&(0,a.jsx)("div",{className:"mt-6 flex justify-end",children:(0,a.jsx)(h.z,{onClick:()=>g(!0),children:"Registrar Pago"})}),(0,a.jsxs)(u.cN,{className:"mt-6",children:[(0,a.jsx)(h.z,{variant:"outline",onClick:async()=>{try{let e=await c.q.getInvoicePdf(t.id);alert(e.message)}catch(e){p.Am.error("Error al generar el PDF.")}},children:"Ver PDF"}),(0,a.jsx)(h.z,{onClick:r,children:"Cerrar"})]})]})})},g=()=>{let{isAuthenticated:e}=(0,r.a)(),[s,t]=(0,n.useState)([]),[u,m]=(0,n.useState)(!0),[j,p]=(0,n.useState)(null),[g,v]=(0,n.useState)(1),[y,N]=(0,n.useState)(1),[b,w]=(0,n.useState)(null),S=(0,n.useCallback)(async s=>{if(e){m(!0);try{let e=await c.q.getAllInvoices(s);t(e.data),N(Math.ceil(e.total/e.limit)),v(e.page)}catch(e){p("Error al cargar las facturas.")}finally{m(!1)}}},[e]);(0,n.useEffect)(()=>{S(g)},[S,g]);let P=e=>{w(e)},C=()=>{w(null)};return u?(0,a.jsx)("div",{children:"Cargando facturas..."}):j?(0,a.jsx)("div",{children:j}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-semibold text-foreground",children:"Gesti\xf3n de Facturas"}),(0,a.jsx)(i.Zb,{children:(0,a.jsx)(i.aY,{children:(0,a.jsxs)(o.iA,{children:[(0,a.jsx)(o.xD,{children:(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.ss,{children:"N\xba Factura"}),(0,a.jsx)(o.ss,{children:"Empresa"}),(0,a.jsx)(o.ss,{children:"Fecha"}),(0,a.jsx)(o.ss,{children:"Total"}),(0,a.jsx)(o.ss,{children:"Estado"}),(0,a.jsx)(o.ss,{children:"Acciones"})]})}),(0,a.jsx)(o.RM,{children:s.map(e=>{var s;return(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.pj,{children:e.invoiceNumber}),(0,a.jsx)(o.pj,{children:null===(s=e.company)||void 0===s?void 0:s.name}),(0,a.jsx)(o.pj,{children:new Date(e.issueDate).toLocaleDateString()}),(0,a.jsx)(o.pj,{children:(0,d.eQ)(e.grandTotal)}),(0,a.jsx)(o.pj,{children:e.status}),(0,a.jsxs)(o.pj,{children:[(0,a.jsx)(h.z,{variant:"ghost",size:"sm",onClick:()=>P(e),children:(0,a.jsx)(x.tE,{className:"w-5 h-5"})}),e.status!==l.UY.PAID&&(0,a.jsx)(h.z,{variant:"ghost",size:"sm",onClick:()=>P(e),children:(0,a.jsx)(x.YH,{className:"w-5 h-5"})})]})]},e.id)})})]})})})]}),b&&(0,a.jsx)(f,{invoice:b,onClose:C,onPaymentSuccess:()=>{C(),S(g)}})]})},v=()=>(0,a.jsx)(g,{})},4493:function(e,s,t){"use strict";var a=t(7437),n=t(2265),r=t(3985),i=t(2869),l=t(5186),d=t(6815),c=t(3647),o=t(6070),h=t(6801),x=t(4438);s.Z=e=>{let{invoice:s,onSave:t,onCancel:u}=e,[m,j]=(0,n.useState)(0),[p,f]=(0,n.useState)(r.XL.CASH),[g,v]=(0,n.useState)(!1),y=async e=>{e.preventDefault(),v(!0);let a={invoiceId:s.id,amount:m,paymentMethod:p};try{await h.t.createPayment(a),x.Am.success("Pago registrado exitosamente"),t()}catch(e){x.Am.error(e.message||"Error al registrar el pago")}finally{v(!1)}};return(0,a.jsxs)(o.Zb,{children:[(0,a.jsx)(o.Ol,{children:(0,a.jsxs)(o.ll,{children:["Registrar Pago para Factura ",s.invoiceNumber]})}),(0,a.jsxs)("form",{onSubmit:y,children:[(0,a.jsxs)(o.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{htmlFor:"amount",children:"Monto"}),(0,a.jsx)(l.I,{id:"amount",type:"number",value:m,onChange:e=>j(Number(e.target.value)),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d._,{htmlFor:"paymentMethod",children:"M\xe9todo de Pago"}),(0,a.jsxs)(c.Ph,{onValueChange:e=>f(e),defaultValue:p,children:[(0,a.jsx)(c.i4,{children:(0,a.jsx)(c.ki,{placeholder:"Seleccione un m\xe9todo de pago"})}),(0,a.jsx)(c.Bw,{children:Object.values(r.XL).map(e=>(0,a.jsx)(c.Ql,{value:e,children:e},e))})]})]})]}),(0,a.jsxs)(o.eW,{className:"flex justify-end space-x-2",children:[(0,a.jsx)(i.z,{type:"button",variant:"outline",onClick:u,children:"Cancelar"}),(0,a.jsx)(i.z,{type:"submit",disabled:g,children:g?"Guardando...":"Guardar Pago"})]})]})]})}},3647:function(e,s,t){"use strict";t.d(s,{Bw:function(){return x},Ph:function(){return c},Ql:function(){return u},i4:function(){return h},ki:function(){return o}});var a=t(7437),n=t(2265),r=t(8238),i=t(875),l=t(401),d=t(4508);let c=r.fC;r.ZA;let o=r.B4,h=n.forwardRef((e,s)=>{let{className:t,children:n,...l}=e;return(0,a.jsxs)(r.xz,{ref:s,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...l,children:[n,(0,a.jsx)(r.JO,{asChild:!0,children:(0,a.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=r.xz.displayName;let x=n.forwardRef((e,s)=>{let{className:t,children:n,position:i="popper",...l}=e;return(0,a.jsx)(r.h_,{children:(0,a.jsx)(r.VY,{ref:s,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...l,children:(0,a.jsx)(r.l_,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n})})})});x.displayName=r.VY.displayName,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.__,{ref:s,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...n})}).displayName=r.__.displayName;let u=n.forwardRef((e,s)=>{let{className:t,children:n,...i}=e;return(0,a.jsxs)(r.ck,{ref:s,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.wU,{children:(0,a.jsx)(l.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(r.eT,{children:n})]})});u.displayName=r.ck.displayName,n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(r.Z0,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",t),...n})}).displayName=r.Z0.displayName},9116:function(e,s,t){"use strict";t.d(s,{h:function(){return r}});var a=t(3464);let n=()=>localStorage.getItem("wolfflow_token"),r=a.Z.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{let s=n();return console.log("Auth Token being sent:",s),s&&(e.headers.Authorization="Bearer ".concat(s)),e},e=>Promise.reject(e))},4038:function(e,s,t){"use strict";var a=t(9116);async function n(e,s){try{let t={};return(null==s?void 0:s.headers)&&(s.headers instanceof Headers?s.headers.forEach((e,s)=>{t[s]=e}):Array.isArray(s.headers)?s.headers.forEach(e=>{let[s,a]=e;t[s]=a}):Object.assign(t,s.headers)),(await (0,a.h)(e,{method:(null==s?void 0:s.method)||"GET",data:null==s?void 0:s.body,headers:t})).data}catch(e){if(e.response)throw Error(e.response.data.message||e.response.statusText);if(e.request)throw Error("No response received from server.");throw Error(e.message)}}s.Z=n},3713:function(e,s,t){"use strict";t.d(s,{q:function(){return n}});var a=t(4038);let n={createInvoiceFromOrder:async e=>(0,a.Z)("/invoices",{method:"POST",body:JSON.stringify({orderId:e})}),async getAllInvoices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,t=arguments.length>2?arguments[2]:void 0,n=new URLSearchParams({page:e.toString(),limit:s.toString()});t&&n.append("status",t);let r=await (0,a.Z)("/invoices?".concat(n.toString()));return{data:r.data,total:r.total,page:r.currentPage,limit:s,pages:r.pages}},getInvoiceById:async e=>(0,a.Z)("/invoices/".concat(e)),getInvoicePdf:async e=>(0,a.Z)("/invoices/".concat(e,"/pdf"))}},6801:function(e,s,t){"use strict";t.d(s,{t:function(){return n}});var a=t(4038);let n={createPayment:async e=>(0,a.Z)("/payments",{method:"POST",body:JSON.stringify(e)}),getPaymentsByInvoice:async e=>(0,a.Z)("/payments?invoiceId=".concat(e))}}},function(e){e.O(0,[6137,3464,3937,9432,9008,4438,8560,9479,2971,2117,1744],function(){return e(e.s=3185)}),_N_E=e.O()}]);