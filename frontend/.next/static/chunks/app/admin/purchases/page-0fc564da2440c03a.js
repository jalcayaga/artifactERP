(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3301],{8134:function(e,t,r){Promise.resolve().then(r.bind(r,7451))},7451:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var n=r(7437),a=r(2265),s=r(9376),o=r(2779),l=r(6070),i=r(8560),c=r(3985),u=r(4508),d=r(660),f=r(3578),m=r(2869),h=()=>{let{isAuthenticated:e,currentUser:t,isLoading:r}=(0,o.a)(),h=(0,s.useRouter)(),[p,g]=(0,a.useState)(!1),[x,N]=(0,a.useState)([]),[v,E]=(0,a.useState)(!0),[y,b]=(0,a.useState)(null),[j,w]=(0,a.useState)(1),[D,C]=(0,a.useState)(1),[R,A]=(0,a.useState)(0),I=(0,a.useCallback)(async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!e||(null==t?void 0:t.role)!==c.i4.ADMIN&&(null==t?void 0:t.role)!==c.i4.EDITOR){b("No autorizado para ver esta p\xe1gina o no autenticado."),E(!1),e||h.push("/login");return}E(!0);try{let e=await d.B.getAllPurchases(r);N(e.data),C(e.pages),w(e.page),A(e.total)}catch(e){console.error("Error fetching purchases:",e),e.message&&e.message.includes("Unauthorized")?h.push("/login"):b("Error al cargar las compras.")}finally{E(!1)}},[e,t,h]);(0,a.useEffect)(()=>{r||I(j)},[I,j,r]);let S=(0,a.useCallback)(()=>{g(!0)},[]);(0,a.useCallback)(async()=>{g(!1),I(j)},[I,j]),(0,a.useCallback)(()=>{g(!1)},[]);let P=e=>{w(e)};return r?(0,n.jsx)("div",{className:"text-center py-8",children:"Cargando autenticaci\xf3n..."}):v?(0,n.jsx)("div",{className:"text-center py-8",children:"Cargando compras..."}):y?(0,n.jsx)("div",{className:"text-center py-8 text-destructive",children:y}):e&&((null==t?void 0:t.role)===c.i4.ADMIN||(null==t?void 0:t.role)===c.i4.EDITOR)?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,n.jsx)("h1",{className:"text-2xl sm:text-3xl font-semibold text-foreground",children:"Gesti\xf3n de Compras"}),(0,n.jsxs)(m.z,{className:"w-full sm:w-auto",onClick:S,children:[(0,n.jsx)(i.pO,{className:"w-5 h-5 mr-2"}),(0,n.jsx)("span",{children:"Registrar Nueva Compra"})]})]}),(0,n.jsx)(l.Zb,{className:"overflow-hidden border",children:(0,n.jsx)(l.aY,{className:"p-0",children:x.length>0?(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)(f.iA,{children:[(0,n.jsx)(f.xD,{className:"bg-muted/50",children:(0,n.jsxs)(f.SC,{children:[(0,n.jsx)(f.ss,{children:"ID Compra"}),(0,n.jsx)(f.ss,{children:"Empresa"}),(0,n.jsx)(f.ss,{className:"hidden sm:table-cell",children:"Fecha"}),(0,n.jsx)(f.ss,{className:"text-right",children:"Total"})]})}),(0,n.jsx)(f.RM,{children:x.map(e=>{var t;return(0,n.jsxs)(f.SC,{className:"hover:bg-accent transition-colors duration-150",children:[(0,n.jsxs)(f.pj,{className:"font-mono text-muted-foreground",children:[e.id.substring(0,8),"..."]}),(0,n.jsx)(f.pj,{children:(0,n.jsx)("div",{className:"font-medium text-foreground",children:null===(t=e.company)||void 0===t?void 0:t.name})}),(0,n.jsx)(f.pj,{className:"hidden sm:table-cell text-muted-foreground",children:new Date(e.purchaseDate).toLocaleDateString()}),(0,n.jsx)(f.pj,{className:"font-semibold text-primary text-right",children:(0,u.eQ)(e.grandTotal)})]},e.id)})})]})}):(0,n.jsxs)("div",{className:"text-center py-12 px-4",children:[(0,n.jsx)(i.Q1,{className:"mx-auto h-16 w-16 text-muted-foreground opacity-40"}),(0,n.jsx)("h3",{className:"mt-3 text-xl font-semibold text-foreground",children:"No hay compras registradas"}),(0,n.jsx)("p",{className:"mt-1.5 text-sm text-muted-foreground",children:"Comienza registrando una nueva compra para verla listada aqu\xed."}),(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsxs)(m.z,{type:"button",onClick:S,children:[(0,n.jsx)(i.pO,{className:"w-5 h-5 mr-2"}),(0,n.jsx)("span",{children:"Registrar Primera Compra"})]})})]})})}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("p",{className:"text-sm text-muted-foreground",children:["P\xe1gina ",j," de ",D," (Total: ",R," compras)"]})}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.z,{variant:"outline",size:"sm",onClick:()=>P(j-1),disabled:j<=1,children:"Anterior"}),(0,n.jsx)(m.z,{variant:"outline",size:"sm",onClick:()=>P(j+1),disabled:j>=D,children:"Siguiente"})]})]})]})}):(0,n.jsx)("div",{className:"text-center py-8 text-destructive",children:"Acceso denegado. No tienes permisos suficientes."})};function p(){return(0,n.jsx)(h,{})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(7437),a=r(2265),s=r(7053),o=r(535),l=r(4508);let i=(0,o.j)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary-500 text-white hover:bg-primary-600",outline:"border border-primary-500 text-primary-500 hover:bg-primary-50",ghost:"hover:bg-gray-100"},size:{default:"h-10 px-4 py-2",sm:"h-8 px-3 text-xs",lg:"h-12 px-8"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:o,asChild:c=!1,...u}=e,d=c?s.g7:"button";return(0,n.jsx)(d,{className:(0,l.cn)(i({variant:a,size:o,className:r})),ref:t,...u})});c.displayName="Button"},6070:function(e,t,r){"use strict";r.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return o},aY:function(){return u},eW:function(){return d},ll:function(){return i}});var n=r(7437),a=r(2265),s=r(4508);let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl bg-card text-card-foreground shadow-sm","border border-border","transition-all duration-200 ease-in-out","hover:shadow-lg dark:hover:shadow-primary/20","hover:border-border dark:hover:border-primary/40","dark:hover:bg-muted/20",r),...a})});o.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-5",r),...a})});l.displayName="CardHeader";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("h3",{ref:t,className:(0,s.cn)("text-xl font-semibold leading-none tracking-tight",r),...a})});i.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("p",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-5 pt-0",r),...a})});u.displayName="CardContent";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-5 pt-0",r),...a})});d.displayName="CardFooter"},3578:function(e,t,r){"use strict";r.d(t,{RM:function(){return i},SC:function(){return c},iA:function(){return o},pj:function(){return d},ss:function(){return u},xD:function(){return l}});var n=r(7437),a=r(2265),s=r(4508);let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{className:"relative w-full overflow-auto",children:(0,n.jsx)("table",{ref:t,className:(0,s.cn)("w-full caption-bottom text-sm",r),...a})})});o.displayName="Table";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("thead",{ref:t,className:(0,s.cn)("[&_tr]:border-b",r),...a})});l.displayName="TableHeader";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("tbody",{ref:t,className:(0,s.cn)("[&_tr:last-child]:border-0",r),...a})});i.displayName="TableBody",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("tfoot",{ref:t,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:hidden",r),...a})}).displayName="TableFooter";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("tr",{ref:t,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...a})});c.displayName="TableRow";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("th",{ref:t,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...a})});u.displayName="TableHead";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("td",{ref:t,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...a})});d.displayName="TableCell",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("caption",{ref:t,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",r),...a})}).displayName="TableCaption"},2779:function(e,t,r){"use strict";r.d(t,{H:function(){return c},a:function(){return u}});var n=r(7437),a=r(2265),s=r(3464);let o="http://localhost:3001",l={login:async e=>{try{return(await s.Z.post("".concat(o,"/auth/login"),e)).data}catch(e){throw e}},register:async e=>{let t={email:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName,role:e.role};try{return(await s.Z.post("".concat(o,"/auth/register"),t)).data}catch(e){throw e}}},i=(0,a.createContext)(void 0),c=e=>{let{children:t}=e,[r,s]=(0,a.useState)(null),[o,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("wolfflow_token"),t=localStorage.getItem("wolfflow_user");if(e&&t){s(e);try{c(JSON.parse(t))}catch(e){console.error("Failed to parse stored user:",e),localStorage.removeItem("wolfflow_user"),localStorage.removeItem("wolfflow_token"),s(null),c(null)}}d(!1)},[]);let f=async e=>{d(!0);try{let t=await l.login(e);if(t&&t.access_token&&t.user)return s(t.access_token),c(t.user),localStorage.setItem("wolfflow_token",t.access_token),localStorage.setItem("wolfflow_user",JSON.stringify(t.user)),d(!1),{success:!0};return d(!1),{success:!1,error:t.message||"Login failed: No token or user data received."}}catch(e){var t,r;return d(!1),{success:!1,error:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||e.message||"An unknown error occurred during login."}}},m=async e=>{d(!0);try{let t=await l.register(e);if(t){let r=await f({email:e.email,password:e.password});return d(!1),{success:r.success,error:r.error,data:t}}return d(!1),{success:!0,data:t}}catch(e){var t,r;return d(!1),{success:!1,error:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||e.message||"An unknown error occurred during registration."}}};return(0,n.jsx)(i.Provider,{value:{token:r,currentUser:o,isAuthenticated:!!r,isLoading:u,login:f,logout:()=>{d(!0),s(null),c(null),localStorage.removeItem("wolfflow_token"),localStorage.removeItem("wolfflow_user"),d(!1)},register:m},children:t})},u=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9116:function(e,t,r){"use strict";r.d(t,{h:function(){return s}});var n=r(3464);let a=()=>localStorage.getItem("wolfflow_token"),s=n.Z.create({baseURL:"http://localhost:3001",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{let t=a();return console.log("Auth Token being sent:",t),t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e))},4038:function(e,t,r){"use strict";var n=r(9116);async function a(e,t){try{let r={};return(null==t?void 0:t.headers)&&(t.headers instanceof Headers?t.headers.forEach((e,t)=>{r[t]=e}):Array.isArray(t.headers)?t.headers.forEach(e=>{let[t,n]=e;r[t]=n}):Object.assign(r,t.headers)),(await (0,n.h)(e,{method:(null==t?void 0:t.method)||"GET",data:null==t?void 0:t.body,headers:r})).data}catch(e){if(e.response)throw Error(e.response.data.message||e.response.statusText);if(e.request)throw Error("No response received from server.");throw Error(e.message)}}t.Z=a},660:function(e,t,r){"use strict";r.d(t,{B:function(){return a}});var n=r(4038);let a={async getAllPurchases(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=await (0,n.Z)("/purchases?page=".concat(e,"&limit=").concat(t));return{data:r.data,total:r.total,page:r.currentPage,limit:t,pages:r.pages}},getPurchaseById:async e=>(0,n.Z)("/purchases/".concat(e)),createPurchase:async e=>(0,n.Z)("/purchases",{method:"POST",body:JSON.stringify(e)}),updatePurchase:async(e,t)=>(0,n.Z)("/purchases/".concat(e),{method:"PATCH",body:JSON.stringify(t)}),async deletePurchase(e){await (0,n.Z)("/purchases/".concat(e),{method:"DELETE"})}}},3985:function(e,t,r){"use strict";var n,a,s,o,l,i,c,u,d,f,m,h;r.d(t,{UY:function(){return l},XL:function(){return s},bG:function(){return a},gS:function(){return o},i4:function(){return i},iF:function(){return n}}),r(2265),(c=n||(n={})).PENDING_PAYMENT="PENDING_PAYMENT",c.PROCESSING="PROCESSING",c.SHIPPED="SHIPPED",c.DELIVERED="DELIVERED",c.CANCELLED="CANCELLED",c.REFUNDED="REFUNDED",(u=a||(a={})).PENDING="PENDING",u.PAID="PAID",u.FAILED="FAILED",u.REFUNDED="REFUNDED",(d=s||(s={})).CASH="CASH",d.DEBIT_CARD="DEBIT_CARD",d.CREDIT_CARD="CREDIT_CARD",d.BANK_TRANSFER="BANK_TRANSFER",d.OTHER="OTHER",(f=o||(o={})).DRAFT="DRAFT",f.SENT="SENT",f.ACCEPTED="ACCEPTED",f.REJECTED="REJECTED",f.EXPIRED="EXPIRED",f.INVOICED="INVOICED",(m=l||(l={})).DRAFT="DRAFT",m.SENT="SENT",m.PAID="PAID",m.PARTIALLY_PAID="PARTIALLY_PAID",m.OVERDUE="OVERDUE",m.VOID="VOID",m.CANCELLED="CANCELLED",(h=i||(i={})).ADMIN="ADMIN",h.EDITOR="EDITOR",h.VIEWER="VIEWER",h.CLIENT="CLIENT"},4508:function(e,t,r){"use strict";r.d(t,{LH:function(){return i},cn:function(){return s},eQ:function(){return o},fW:function(){return c},p6:function(){return l}});var n=r(1994),a=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}function o(e){let t=Number(e);if(isNaN(t))return"$0";let r=Math.abs(t),n=(r%1).toFixed(2).substring(2),a=Math.trunc(r).toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."),s="$".concat(a);return"00"!==n&&(s+=",".concat(n)),t<0?"-".concat(s):s}function l(e){try{let t=new Date(e),r=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear();return"".concat(r,"/").concat(n,"/").concat(a)}catch(t){return console.error("Invalid date provided to formatDate:",e),"Fecha inv\xe1lida"}}function i(e){if("string"!=typeof e)return NaN;let t=parseFloat(e.replace(/\$\s?|(,*)/g,"").replace(/\./g,"").replace(",","."));return isNaN(t)?0:t}function c(e){if("string"!=typeof e||(e=e.replace(/\./g,"").replace(/-/g,"")).length<2)return!1;let t=e.slice(0,-1),r=e.slice(-1).toUpperCase(),n=0,a=2;for(let e=t.length-1;e>=0;e--)n+=parseInt(t[e],10)*a,++a>7&&(a=2);let s=11-n%11;return(11===s?"0":10===s?"K":s.toString())===r}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},8575:function(e,t,r){"use strict";r.d(t,{F:function(){return s},e:function(){return o}});var n=r(2265);function a(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function s(...e){return t=>{let r=!1,n=e.map(e=>{let n=a(e,t);return r||"function"!=typeof n||(r=!0),n});if(r)return()=>{for(let t=0;t<n.length;t++){let r=n[t];"function"==typeof r?r():a(e[t],null)}}}}function o(...e){return n.useCallback(s(...e),e)}},7053:function(e,t,r){"use strict";r.d(t,{Z8:function(){return o},g7:function(){return l}});var n=r(2265),a=r(8575),s=r(7437);function o(e){let t=function(e){let t=n.forwardRef((e,t)=>{let{children:r,...s}=e;if(n.isValidElement(r)){let e,o;let l=(e=Object.getOwnPropertyDescriptor(r.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.ref:(e=Object.getOwnPropertyDescriptor(r,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?r.props.ref:r.props.ref||r.ref,i=function(e,t){let r={...t};for(let n in t){let a=e[n],s=t[n];/^on[A-Z]/.test(n)?a&&s?r[n]=(...e)=>{let t=s(...e);return a(...e),t}:a&&(r[n]=a):"style"===n?r[n]={...a,...s}:"className"===n&&(r[n]=[a,s].filter(Boolean).join(" "))}return{...e,...r}}(s,r.props);return r.type!==n.Fragment&&(i.ref=t?(0,a.F)(t,l):l),n.cloneElement(r,i)}return n.Children.count(r)>1?n.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=n.forwardRef((e,r)=>{let{children:a,...o}=e,l=n.Children.toArray(a),i=l.find(c);if(i){let e=i.props.children,a=l.map(t=>t!==i?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,s.jsx)(t,{...o,ref:r,children:n.isValidElement(e)?n.cloneElement(e,void 0,a):null})}return(0,s.jsx)(t,{...o,ref:r,children:a})});return r.displayName=`${e}.Slot`,r}var l=o("Slot"),i=Symbol("radix.slottable");function c(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===i}},535:function(e,t,r){"use strict";r.d(t,{j:function(){return o}});var n=r(1994);let a=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,s=n.W,o=(e,t)=>r=>{var n;if((null==t?void 0:t.variants)==null)return s(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:o,defaultVariants:l}=t,i=Object.keys(o).map(e=>{let t=null==r?void 0:r[e],n=null==l?void 0:l[e];if(null===t)return null;let s=a(t)||a(n);return o[e][s]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,n]=t;return void 0===n||(e[r]=n),e},{});return s(e,i,null==t?void 0:null===(n=t.compoundVariants)||void 0===n?void 0:n.reduce((e,t)=>{let{class:r,className:n,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...c}[t]):({...l,...c})[t]===r})?[...e,r,n]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}},function(e){e.O(0,[6137,3464,8560,2971,2117,1744],function(){return e(e.s=8134)}),_N_E=e.O()}]);